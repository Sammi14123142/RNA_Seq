{
    "contents" : "library(minfi)\n## DOwnload\n## colon/DNA_Methylation/JHU_USC__HumanMethylation450/Level_1/\n## from tcga and put in datadir\ndatadir=\"/datadir\"\n\n\nclinicalDir=file.path(datadir,\"Clinical/Biotab\")\nsample_tab=read.delim(file.path(clinicalDir,\"biospecimen_sample_coad.txt\"),sep=\"\\t\",stringsAsFactors=FALSE)\nkeep=sample_tab$sample_type %in% c(\"Primary Tumor\", \"Solid Tissue Normal\")\nsample_tab=sample_tab[keep,]\n\npatient_id=unique(sapply(strsplit(sample_tab$bcr_sample_barcode,split=\"-\"), function(x) paste(x[1:3],collapse=\"-\")))\n\ntumor_sample_id=sample_tab$bcr_sample_uuid[sample_tab$sample_type==\"Primary Tumor\"]\nnormal_sample_id=sample_tab$bcr_sample_uuid[sample_tab$sample_type==\"Solid Tissue Normal\"]\n\n# read tumor data\ntumor_tab=read.delim(file.path(clinicalDir,\"biospecimen_tumor_sample_coad.txt\"),sep=\"\\t\",stringsAsFactors=FALSE)\n\ntab=merge(sample_tab, tumor_tab, by=\"bcr_sample_uuid\", suffixes=c(\".sample\",\".tumor\"),all.x=TRUE)\n\n# read normal data\nnormal_tab=read.delim(file.path(clinicalDir,\"biospecimen_normal_control_coad.txt\"),sep=\"\\t\",stringsAsFactors=FALSE)\ntab=merge(tab, normal_tab, by=\"bcr_sample_uuid\", suffixes=c(\".tumor\",\".normal\"),all.x=TRUE)\n\ntab$bcr_patient_barcode=tab$bcr_patient_barcode.tumor\n\nii=is.na(tab$bcr_patient_barcode)\ntab$bcr_patient_barcode[ii]=tab$bcr_patient_barcode.normal[ii]\n\n# read patient data\npatient_tab=read.delim(file.path(clinicalDir,\"clinical_patient_coad.txt\"),sep=\"\\t\",stringsAsFactors=FALSE)\nnames(patient_tab)=paste(\"patient\",names(patient_tab),sep=\".\")\ntmp=merge(tab,patient_tab,by.x=\"bcr_patient_barcode\",by.y=\"patient.bcr_patient_barcode\",all.x=TRUE,suffixes=c(\".sample\",\".patient\"))\ntab=tmp\n\n# read meth metadata\nmethMetaDir=file.path(datadir,\"METADATA/JHU_USC__HumanMethylation450\")\nmethMeta_tab=read.delim(file.path(methMetaDir,\"jhu-usc.edu_COAD.HumanMethylation450.1.4.0.sdrf.txt\"),sep=\"\\t\",stringsAsFactors=FALSE)\n\nsample_barcode=sapply(strsplit(methMeta_tab$Comment..TCGA.Barcode.,split=\"-\"),function(x) paste(x[1:4],collapse=\"-\"))\nm=match(tab$bcr_sample_barcode,sample_barcode)\ntab$Basename=gsub(\"_Grn\\\\.idat\",\"\",methMeta_tab$Array.Data.File[m])\ntab=tab[!is.na(tab$Basename),]\n\nbasedir=file.path(datadir,\"DNA_Methylation/JHU_USC__HumanMethylation450/Level_1\")\ntab$Basename=file.path(basedir,tab$Basename)\nkeep=file.exists(paste(tab$Basename,\"_Grn.idat\",sep=\"\"))\ncolon_targets=tab\nobjs=grep(\"tab\",ls(),value=TRUE)\nrm(list=objs)\nobjs=grep(\"dir\",ls(),value=TRUE,ignore=TRUE)\nrm(list=objs)\n\nnms=names(colon_targets)\ntargets=colon_targets[nms]\n\ntargets$Status=factor(ifelse(targets$sample_type==\"Primary Tumor\",\"cancer\",\"normal\"),levels=c(\"normal\",\"cancer\"))\ntargets$Tissue=tolower(targets$patient.tumor_tissue_site)\ntargets$Sex=targets$patient.gender\n\ndatadir=\"rdas\"\nsave(targets,colon_targets,breast_targets,lung_targets,file=file.path(datadir,\"targets.rda\"))\n\n##read raw data\nrgset <- read.450k(targets$Basename,verbose=TRUE)\npData(rgset)<-targets\n\n#normalize with illumina default\nmset1<-preprocessIllumina(rgset)\nmset1<-mapToGenome(mset1)\nmeth <- getBeta(mset1,type=\"Illumina\")\ngr <- granges(mset1)\npd <- pData(mset1)\n\nsave(meth,gr,pd,file=\"coloncancermeth.rda\")",
    "created" : 1461569565900.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1451474947",
    "id" : "798BCC5D",
    "lastKnownWriteTime" : 1461545010,
    "path" : "C:/Users/Library/Downloads/DNAmethylation/Rs/readTCGAmeth.R",
    "project_path" : "readTCGAmeth.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}